<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Used Cars</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="style.css">
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background-color: #f2f2f2; 
      text-align: center; 
    }
    .container {
      width: 50%; 
      margin: 50px auto; 
      padding: 20px; 
      background: #fff; 
      border: 1px solid #ccc; 
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label { 
      display: block; 
      margin: 15px 0 5px; 
      text-align: left;
    }
    select, input[type="text"] {
      width: 100%; 
      padding: 8px; 
      box-sizing: border-box;
    }
    .radio-group { 
      text-align: left; 
      margin-top: 10px; 
    }
    .radio-group input { 
      margin-right: 5px;
    }
    .error { 
      color: red; 
      font-size: 0.9em; 
    }
    #resultContainer {
      display: none; 
      font-size: 2em; 
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <a href="home.html" class="logo-container">
      <img src="images/logo.png" alt="Logo">
  </a>

  <div class="title-container">
      <br />
      <a href="home.html" class="nav-button">Home</a>
      <a href="shop.html" class="nav-button">Shop</a>
      <a href="carvalcalc.html" class="nav-button">Value Calculator</a>
      <a href="about.html" class="nav-button">About Us</a>
      <a href="help.html" class="nav-button">Help</a>
      <a href="reviews.html" class="nav-button">Reviews</a>
      <a href="contact.html" class="nav-button">Contact Us</a>
      <br /><br />
  </div>

  <div class="container">
    <div id="initialForm">
      <h2>Select Your Car</h2>
      <form id="carForm">
        <!-- Car Make (populated dynamically from the JSON file) -->
        <label for="make">Car Make:</label>
        <select id="make" name="make">
          <option value="">Select a make</option>
        </select>

        <!-- Car Model (populated based on the selected make) -->
        <label for="model">Car Model:</label>
        <select id="model" name="model">
          <option value="">Select a model</option>
        </select>

        <!-- Year (static selection) -->
        <label for="year">Year:</label>
        <select id="year" name="year">
          <option value="">Select a year</option>
          <script>
            for (let y = 2025; y >= 1980; y--) {
              document.write('<option value="' + y + '">' + y + '</option>');
            }
          </script>
        </select>

        <!-- Condition radio buttons -->
        <label>Condition:</label>
        <div class="radio-group">
          <input type="radio" id="good" name="condition" value="good">
          <label for="good" style="display:inline;">Good</label>
          <input type="radio" id="average" name="condition" value="average">
          <label for="average" style="display:inline;">Average</label>
          <input type="radio" id="poor" name="condition" value="poor">
          <label for="poor" style="display:inline;">Poor</label>
        </div>

        <!-- Mileage input -->
        <label for="mileage">Mileage:</label>
        <input type="text" id="mileage" name="mileage">

        <button type="submit" id="submitBtn">Calculate Trade-In Value</button>
      </form>
    </div>

    <!-- Result container (hidden by default) -->
    <div id="resultContainer">
      <h2>Estimated Trade-In Value</h2>
      <p>$<span id="resultValue">0</span></p>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      var vehicles = [];
      // Load the car information from the JSON file
      $.getJSON("carcalc.json", function(data) {
          vehicles = data;
          var makes = [];
          // Populate the "make" dropdown with unique makes from the JSON data
          $.each(vehicles, function(index, vehicle) {
            // Check if a particular make is NOT already in the array and push it
            if ($.inArray(vehicle.make, makes) === -1) {
              makes.push(vehicle.make);
            }
          });
          // Get makes in alphabetical order
          makes.sort();
          // Add makes to the dropdown
          $.each(makes, function(index, make) {
            $("#make").append($("<option>", {value: make, text: make}));
          });
        })

      // When a make is selected, populate the "model" dropdown with associated models
      $("#make").change(function() {
        var selectedMake = $(this).val();
        $("#model").html('<option value="">Select a model</option>');
        var models = [];
        $.each(vehicles, function(index, vehicle) {
            // Check through all vehicles with the same make as selected make and push
            // their models into the model dropdown if it is not already in the array
            if (vehicle.make === selectedMake && $.inArray(vehicle.model, models) === -1) {
              models.push(vehicle.model);
            }
        });
        // Get models in alphabetical order
        models.sort();
        $.each(models, function(index, model) {
            $("#model").append($("<option>", { value: model, text: model }));
        });
      });

      // Custom form validation and submission
      $("#carForm").on("submit", function(submit) {
        // Stops form from submitting
        submit.preventDefault();
        $(".error").remove(); // Remove any existing error messages
        var valid = true;

        // Validate Car Make
        if ($("#make").val() === "") {
          $("#make").after("<div class='error'>Please select a car make</div>");
          valid = false;
        }
        // Validate Car Model
        if ($("#model").val() === "") {
          $("#model").after("<div class='error'>Please select a car model</div>");
          valid = false;
        }
        // Validate Year
        if ($("#year").val() === "") {
          $("#year").after("<div class='error'>Please select a car year</div>");
          valid = false;
        }
        // Validate Condition
        if ($("input[name='condition']:checked").length === 0) {
          $(".radio-group").after("<div class='error'>Please select a condition</div>");
          valid = false;
        }
        // Validate Mileage
        var mileageVal = $("#mileage").val();
        if (mileageVal === "" || isNaN(mileageVal) || parseFloat(mileageVal) < 0) {
          $("#mileage").after("<div class='error'>Please enter a valid mileage</div>");
          valid = false;
        }

        if (!valid) {
          return; // Stop processing if validation fails
        }

        // Calculation logic for trade-in value
        let baseValue = 50000;
        let selectedYear = parseInt($("#year").val());
        let mileage = parseInt($("#mileage").val());
        let condition = $("input[name='condition']:checked").val();
        let ageDeduction = (2025 - selectedYear) * 500;
        let mileageDeduction = Math.floor(mileage * 0.67);
        let computedValue = baseValue - ageDeduction - mileageDeduction;
        if (computedValue < 0) {
            computedValue = 0;
        }
        let conditionFactor = 1;
        if (condition === 'average') {
            conditionFactor = 0.85;
        }
        else if (condition === 'poor') {
            conditionFactor = 0.5;
        }
        let tradeInValue = computedValue * conditionFactor;

        // Fade out the form and fade in the result container with a counting effect
        $("#carForm").fadeOut(500, function() {
          $("#resultContainer").fadeIn(500, function() {
            let counter = 0;
            $({counter}).animate({counter: tradeInValue}, {
                duration: 2000,
                easing: "linear",
                step: function() {
                    $("#resultValue").text(this.counter.toFixed(2));
                }
            });
          });
        });
      });
    });
  </script>
</body>
</html>
